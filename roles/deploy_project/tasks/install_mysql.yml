---

- name: Download MySQL APT configuration package 
  copy:
    src: files/mysql-apt-config_0.8.30-1_all.deb
    dest: /tmp/mysql-apt-config.deb
  become: yes

- name: Install GnuPG (for package verification)
  apt:
    name: gnupg
    state: present

- name: Install MySQL APT configuration package
  command: dpkg -i /tmp/mysql-apt-config.deb
  environment:
    DEBIAN_FRONTEND: noninteractive
  become: yes

- name: Update APT cache
  apt:
    update_cache: yes
  become: yes
  
- name: Install MySQL Server
  apt:
    name: mysql-server
    state: present

- name: Iniciar y habilitar MySQL
  service:
    name: mysql
    state: started
    enabled: yes

- name: Instalar módulo de python
  apt:
    name: python3-mysqldb
    state: present
    update-cache: yes

- name: Cargar módulo necesario
  blockinfile:
    path: /etc/mysql/mariadb.cnf
    block: |
      [mysqld]
      mysql_native_password=ON
    state: present

- name: Reiniciar servicio
  service:
    name: mysql
    state: restarted